name: 'Test Madronalib'
description: 'Run madronalib test suite from existing build'
inputs:
  platform:
    description: 'Platform to test on (linux, windows, macos)'
    required: true
runs:
  using: 'composite'
  steps:
    # Test madronalib on Linux - checks both bin/ and root locations for test executable
    - name: Test madronalib (Linux)
      if: inputs.platform == 'linux'
      shell: bash
      run: |
        echo "Current directory: $(pwd)"
        echo "Contents of current directory:"
        ls -la
        echo "Checking if madronalib/build exists:"
        ls -la madronalib/ || echo "madronalib directory not found"
        echo "Changing to madronalib/build..."
        cd madronalib/build
        echo "Now in directory: $(pwd)"
        echo "Contents of build directory:"
        ls -la
        echo "Looking for test executable..."
        find . -name "*tests*" -type f
        if [ -f "./bin/tests" ]; then
          ./bin/tests
        elif [ -f "./tests" ]; then
          ./tests
        else
          echo "Error: Test executable not found in madronalib/build/"
          exit 1
        fi
    
    # Test madronalib on Windows - checks both Release/ and bin/ locations for test executable
    - name: Test madronalib (Windows)
      if: inputs.platform == 'windows'
      shell: pwsh
      run: |
        Write-Host "Current directory: $(Get-Location)"
        Write-Host "Contents of current directory:"
        Get-ChildItem
        Write-Host "Checking if madronalib/build exists:"
        if (Test-Path "madronalib") {
          Get-ChildItem madronalib
        } else {
          Write-Host "madronalib directory not found"
        }
        Write-Host "Changing to madronalib/build..."
        cd madronalib/build
        Write-Host "Now in directory: $(Get-Location)"
        Write-Host "Contents of build directory:"
        Get-ChildItem
        Write-Host "Looking for test executable..."
        Get-ChildItem -Recurse -Name "*tests*"
        if (Test-Path "./Release/tests.exe") {
          ./Release/tests.exe
        } elseif (Test-Path "./bin/tests.exe") {
          ./bin/tests.exe
        } else {
          Write-Error "Error: Test executable not found in madronalib/build/"
          exit 1
        }
    
    # Test madronalib on macOS - checks both bin/ and root locations for test executable
    - name: Test madronalib (macOS)
      if: inputs.platform == 'macos'
      shell: bash
      run: |
        echo "Current directory: $(pwd)"
        echo "Contents of current directory:"
        ls -la
        echo "Checking if madronalib/build exists:"
        ls -la madronalib/ || echo "madronalib directory not found"
        echo "Changing to madronalib/build..."
        cd madronalib/build
        echo "Now in directory: $(pwd)"
        echo "Contents of build directory:"
        ls -la
        echo "Looking for test executable..."
        find . -name "*tests*" -type f
        if [ -f "./bin/tests" ]; then
          ./bin/tests
        elif [ -f "./tests" ]; then
          ./tests
        else
          echo "Error: Test executable not found in madronalib/build/"
          exit 1
        fi
